
'use strict';

describe('Tasks list window', function () {
    var controller, testScope, vraInstallFactory, trans, siteSettingsFactory, globalStateModel;

    beforeEach(module('zvmTest'));

    beforeEach(inject(function (_globalStateModel_) {
        globalStateModel = _globalStateModel_;
        globalStateModel.data = {
            VirtualizationProviderType: 0
        };
    }));

    beforeEach(inject(function ($injector, $controller, $rootScope, $translate, _siteSettingsFactory_) {
        testScope = $rootScope.$new();
        siteSettingsFactory= _siteSettingsFactory_;
        //mock data
        testScope.data = [{"TaskType":5,"VpgScreenState":{"State":0,"Status":2,"SubStatus":8,"IsProgressActive":false,"ProgressPercentage":0,"ProgressDetails":null,"IsFailoverEnabled":false,"IsMoveEnabled":false,"IsFailoverTestEnabled":false,"IsUpdateEnabled":false,"IsInsertCheckpointEnabled":false,"RelevantCheckpoint":null,"IsProtectedSiteConnected":false,"AlertStatus":2,"AlertTips":{"Alerts":[{"Description":"Journal volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1},{"Description":"Journal volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1},{"Description":"Recovery volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1}],"HasMore":true,"TotalNumberOfAlerts":7},"IsDeleteEnabled":true,"IsForceSyncEnabled":false,"IsCloneEnabled":false,"VPGTimebombInfo":null,"CloneStatusVisualObject":null,"IsMoveInStagesSupported":true,"IsFailoverInStagesSupported":true,"MoveAutoContinueState":{"AutoContinueActivated":false,"Action":1,"TimeLeftInSec":0},"RequiresForceToDelete":false,"PauseResumeVisualObject":{"IsVpgNowPaused":false,"IsPauseEnabled":false,"IsResumeEnabled":false},"IsRecoverCommitEnabled":false,"IsRecoverRollbackEnabled":false,"ActiveProcesses":{"RunningFailOverTest":null,"RunningClone":null,"Paused":null,"IsVpgNowPaused":false,"IsResumeEnabled":false,"RunningBackup":null,"IsStopFOTEnabled":false,"VpgUpdate":null,"TimebombInfo":null},"ButtonsState":{"IsFailoverEnabled":false,"IsMoveEnabled":false,"IsFailoverTestEnabled":false,"IsUpdateEnabled":false,"IsPauseEnabled":false,"IsInsertCheckpointEnabled":false,"IsProtectedSiteConnected":false,"IsDeleteEnabled":true,"IsForceSyncEnabled":false,"IsCloneEnabled":false,"IsMoveInStagesSupported":true,"IsFailoverInStagesSupported":true,"IsRecoverCommitEnabled":false,"IsRecoverRollbackEnabled":false,"RequiresForceToDelete":false,"IsBackupEnabled":false,"IsAbortBackupEnabled":false},"ProgressObject":null},"StateAndProgress":{"Progress":100,"CurrentState":5},"RelatedEntities":[{"HostId":null,"Name":"xxx","ProtectionGroupId":{"GroupGuid":"b77dfe08-3b8a-4312-bb6d-a0472ad216b4"},"SiteId":null},{"HostId":null,"Name":"Local","ProtectionGroupId":null,"SiteId":{"SiteGuid":"3fad0bc0-8c6d-4673-aad6-bb4f9e4ed26a"}}],"ProtectionGroupId":{"GroupGuid":"b77dfe08-3b8a-4312-bb6d-a0472ad216b4"},"InitiatedBy":"root","Started":"13/10/2014 13:57:40","Completed":"13/10/2014 13:58:05","TaskId":{"Identifier":"a3e1f181-b75b-45f2-b926-340df31ee7ec","SiteId":{"SiteGuid":"3fad0bc0-8c6d-4673-aad6-bb4f9e4ed26a"}},"IsCancellable":false,"Information":"","id":"a3e1f181-b75b-45f2-b926-340df31ee7ec","TaskTypeName":"Stopping Failover test","StatusText":"Completed","CurrentState":5,"RelatedText":"xxx, Local"},{"TaskType":55,"VpgScreenState":{"State":0,"Status":2,"SubStatus":8,"IsProgressActive":false,"ProgressPercentage":0,"ProgressDetails":null,"IsFailoverEnabled":false,"IsMoveEnabled":false,"IsFailoverTestEnabled":false,"IsUpdateEnabled":false,"IsInsertCheckpointEnabled":false,"RelevantCheckpoint":null,"IsProtectedSiteConnected":false,"AlertStatus":2,"AlertTips":{"Alerts":[{"Description":"Journal volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1},{"Description":"Journal volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1},{"Description":"Recovery volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1}],"HasMore":true,"TotalNumberOfAlerts":7},"IsDeleteEnabled":true,"IsForceSyncEnabled":false,"IsCloneEnabled":false,"VPGTimebombInfo":null,"CloneStatusVisualObject":null,"IsMoveInStagesSupported":true,"IsFailoverInStagesSupported":true,"MoveAutoContinueState":{"AutoContinueActivated":false,"Action":1,"TimeLeftInSec":0},"RequiresForceToDelete":false,"PauseResumeVisualObject":{"IsVpgNowPaused":false,"IsPauseEnabled":false,"IsResumeEnabled":false},"IsRecoverCommitEnabled":false,"IsRecoverRollbackEnabled":false,"ActiveProcesses":{"RunningFailOverTest":null,"RunningClone":null,"Paused":null,"IsVpgNowPaused":false,"IsResumeEnabled":false,"RunningBackup":null,"IsStopFOTEnabled":false,"VpgUpdate":null,"TimebombInfo":null},"ButtonsState":{"IsFailoverEnabled":false,"IsMoveEnabled":false,"IsFailoverTestEnabled":false,"IsUpdateEnabled":false,"IsPauseEnabled":false,"IsInsertCheckpointEnabled":false,"IsProtectedSiteConnected":false,"IsDeleteEnabled":true,"IsForceSyncEnabled":false,"IsCloneEnabled":false,"IsMoveInStagesSupported":true,"IsFailoverInStagesSupported":true,"IsRecoverCommitEnabled":false,"IsRecoverRollbackEnabled":false,"RequiresForceToDelete":false,"IsBackupEnabled":false,"IsAbortBackupEnabled":false},"ProgressObject":null},"StateAndProgress":{"Progress":100,"CurrentState":5},"RelatedEntities":[{"HostId":null,"Name":"vpg2","ProtectionGroupId":{"GroupGuid":"4f857635-1791-4773-a3bb-d85c9ef9112a"},"SiteId":null},{"HostId":null,"Name":"Local","ProtectionGroupId":null,"SiteId":{"SiteGuid":"3fad0bc0-8c6d-4673-aad6-bb4f9e4ed26a"}}],"ProtectionGroupId":{"GroupGuid":"4f857635-1791-4773-a3bb-d85c9ef9112a"},"InitiatedBy":"root","Started":"13/10/2014 11:42:34","Completed":"13/10/2014 11:42:55","TaskId":{"Identifier":"0d143e06-cb1b-4abf-9880-280f07148178","SiteId":{"SiteGuid":"3fad0bc0-8c6d-4673-aad6-bb4f9e4ed26a"}},"IsCancellable":false,"Information":"Full. Backup Job Duration: 00:00:18. Backup Job Actual Size: 8.00MB.  ","id":"0d143e06-cb1b-4abf-9880-280f07148178","TaskTypeName":"Backing up VPG","StatusText":"Completed","CurrentState":5,"RelatedText":"vpg2, Local"},{"TaskType":1,"VpgScreenState":{"State":0,"Status":2,"SubStatus":8,"IsProgressActive":false,"ProgressPercentage":0,"ProgressDetails":null,"IsFailoverEnabled":false,"IsMoveEnabled":false,"IsFailoverTestEnabled":false,"IsUpdateEnabled":false,"IsInsertCheckpointEnabled":false,"RelevantCheckpoint":null,"IsProtectedSiteConnected":false,"AlertStatus":2,"AlertTips":{"Alerts":[{"Description":"Journal volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1},{"Description":"Journal volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1},{"Description":"Recovery volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1}],"HasMore":true,"TotalNumberOfAlerts":7},"IsDeleteEnabled":true,"IsForceSyncEnabled":false,"IsCloneEnabled":false,"VPGTimebombInfo":null,"CloneStatusVisualObject":null,"IsMoveInStagesSupported":true,"IsFailoverInStagesSupported":true,"MoveAutoContinueState":{"AutoContinueActivated":false,"Action":1,"TimeLeftInSec":0},"RequiresForceToDelete":false,"PauseResumeVisualObject":{"IsVpgNowPaused":false,"IsPauseEnabled":false,"IsResumeEnabled":false},"IsRecoverCommitEnabled":false,"IsRecoverRollbackEnabled":false,"ActiveProcesses":{"RunningFailOverTest":null,"RunningClone":null,"Paused":null,"IsVpgNowPaused":false,"IsResumeEnabled":false,"RunningBackup":null,"IsStopFOTEnabled":false,"VpgUpdate":null,"TimebombInfo":null},"ButtonsState":{"IsFailoverEnabled":false,"IsMoveEnabled":false,"IsFailoverTestEnabled":false,"IsUpdateEnabled":false,"IsPauseEnabled":false,"IsInsertCheckpointEnabled":false,"IsProtectedSiteConnected":false,"IsDeleteEnabled":true,"IsForceSyncEnabled":false,"IsCloneEnabled":false,"IsMoveInStagesSupported":true,"IsFailoverInStagesSupported":true,"IsRecoverCommitEnabled":false,"IsRecoverRollbackEnabled":false,"RequiresForceToDelete":false,"IsBackupEnabled":false,"IsAbortBackupEnabled":false},"ProgressObject":null},"StateAndProgress":{"Progress":100,"CurrentState":5},"RelatedEntities":[{"HostId":null,"Name":"vpg2","ProtectionGroupId":{"GroupGuid":"4f857635-1791-4773-a3bb-d85c9ef9112a"},"SiteId":null},{"HostId":null,"Name":"Local","ProtectionGroupId":null,"SiteId":{"SiteGuid":"3fad0bc0-8c6d-4673-aad6-bb4f9e4ed26a"}}],"ProtectionGroupId":{"GroupGuid":"4f857635-1791-4773-a3bb-d85c9ef9112a"},"InitiatedBy":"root","Started":"13/10/2014 11:41:08","Completed":"13/10/2014 11:41:36","TaskId":{"Identifier":"81574373-5479-4984-bdfb-7503c1a3dbf7","SiteId":{"SiteGuid":"3fad0bc0-8c6d-4673-aad6-bb4f9e4ed26a"}},"IsCancellable":false,"Information":"","id":"81574373-5479-4984-bdfb-7503c1a3dbf7","TaskTypeName":"Creating VPG","StatusText":"Completed","CurrentState":5,"RelatedText":"vpg2, Local"},{"TaskType":4,"VpgScreenState":{"State":0,"Status":2,"SubStatus":8,"IsProgressActive":false,"ProgressPercentage":0,"ProgressDetails":null,"IsFailoverEnabled":false,"IsMoveEnabled":false,"IsFailoverTestEnabled":false,"IsUpdateEnabled":false,"IsInsertCheckpointEnabled":false,"RelevantCheckpoint":null,"IsProtectedSiteConnected":false,"AlertStatus":2,"AlertTips":{"Alerts":[{"Description":"Journal volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1},{"Description":"Journal volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1},{"Description":"Recovery volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1}],"HasMore":true,"TotalNumberOfAlerts":7},"IsDeleteEnabled":true,"IsForceSyncEnabled":false,"IsCloneEnabled":false,"VPGTimebombInfo":null,"CloneStatusVisualObject":null,"IsMoveInStagesSupported":true,"IsFailoverInStagesSupported":true,"MoveAutoContinueState":{"AutoContinueActivated":false,"Action":1,"TimeLeftInSec":0},"RequiresForceToDelete":false,"PauseResumeVisualObject":{"IsVpgNowPaused":false,"IsPauseEnabled":false,"IsResumeEnabled":false},"IsRecoverCommitEnabled":false,"IsRecoverRollbackEnabled":false,"ActiveProcesses":{"RunningFailOverTest":null,"RunningClone":null,"Paused":null,"IsVpgNowPaused":false,"IsResumeEnabled":false,"RunningBackup":null,"IsStopFOTEnabled":false,"VpgUpdate":null,"TimebombInfo":null},"ButtonsState":{"IsFailoverEnabled":false,"IsMoveEnabled":false,"IsFailoverTestEnabled":false,"IsUpdateEnabled":false,"IsPauseEnabled":false,"IsInsertCheckpointEnabled":false,"IsProtectedSiteConnected":false,"IsDeleteEnabled":true,"IsForceSyncEnabled":false,"IsCloneEnabled":false,"IsMoveInStagesSupported":true,"IsFailoverInStagesSupported":true,"IsRecoverCommitEnabled":false,"IsRecoverRollbackEnabled":false,"RequiresForceToDelete":false,"IsBackupEnabled":false,"IsAbortBackupEnabled":false},"ProgressObject":null},"StateAndProgress":{"Progress":100,"CurrentState":5},"RelatedEntities":[{"HostId":null,"Name":"xxx","ProtectionGroupId":{"GroupGuid":"b77dfe08-3b8a-4312-bb6d-a0472ad216b4"},"SiteId":null},{"HostId":null,"Name":"Local","ProtectionGroupId":null,"SiteId":{"SiteGuid":"3fad0bc0-8c6d-4673-aad6-bb4f9e4ed26a"}}],"ProtectionGroupId":{"GroupGuid":"b77dfe08-3b8a-4312-bb6d-a0472ad216b4"},"InitiatedBy":"root","Started":"13/10/2014 10:46:07","Completed":"13/10/2014 10:46:58","TaskId":{"Identifier":"ce9b8fd0-c97e-4b28-a5a2-622b68c8cb40","SiteId":{"SiteGuid":"3fad0bc0-8c6d-4673-aad6-bb4f9e4ed26a"}},"IsCancellable":false,"Information":"","id":"ce9b8fd0-c97e-4b28-a5a2-622b68c8cb40","TaskTypeName":"Failover test","StatusText":"Completed","CurrentState":5,"RelatedText":"xxx, Local"},{"TaskType":1,"VpgScreenState":{"State":0,"Status":2,"SubStatus":8,"IsProgressActive":false,"ProgressPercentage":0,"ProgressDetails":null,"IsFailoverEnabled":false,"IsMoveEnabled":false,"IsFailoverTestEnabled":false,"IsUpdateEnabled":false,"IsInsertCheckpointEnabled":false,"RelevantCheckpoint":null,"IsProtectedSiteConnected":false,"AlertStatus":2,"AlertTips":{"Alerts":[{"Description":"Journal volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1},{"Description":"Journal volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1},{"Description":"Recovery volume on host 172.20.200.2 was deleted from the Hypervisor. Delete the VPG and recreate it to restart the protection of the virtual machines.","SiteName":"gui_local","AlertLevel":1}],"HasMore":true,"TotalNumberOfAlerts":7},"IsDeleteEnabled":true,"IsForceSyncEnabled":false,"IsCloneEnabled":false,"VPGTimebombInfo":null,"CloneStatusVisualObject":null,"IsMoveInStagesSupported":true,"IsFailoverInStagesSupported":true,"MoveAutoContinueState":{"AutoContinueActivated":false,"Action":1,"TimeLeftInSec":0},"RequiresForceToDelete":false,"PauseResumeVisualObject":{"IsVpgNowPaused":false,"IsPauseEnabled":false,"IsResumeEnabled":false},"IsRecoverCommitEnabled":false,"IsRecoverRollbackEnabled":false,"ActiveProcesses":{"RunningFailOverTest":null,"RunningClone":null,"Paused":null,"IsVpgNowPaused":false,"IsResumeEnabled":false,"RunningBackup":null,"IsStopFOTEnabled":false,"VpgUpdate":null,"TimebombInfo":null},"ButtonsState":{"IsFailoverEnabled":false,"IsMoveEnabled":false,"IsFailoverTestEnabled":false,"IsUpdateEnabled":false,"IsPauseEnabled":false,"IsInsertCheckpointEnabled":false,"IsProtectedSiteConnected":false,"IsDeleteEnabled":true,"IsForceSyncEnabled":false,"IsCloneEnabled":false,"IsMoveInStagesSupported":true,"IsFailoverInStagesSupported":true,"IsRecoverCommitEnabled":false,"IsRecoverRollbackEnabled":false,"RequiresForceToDelete":false,"IsBackupEnabled":false,"IsAbortBackupEnabled":false},"ProgressObject":null},"StateAndProgress":{"Progress":100,"CurrentState":5},"RelatedEntities":[{"HostId":null,"Name":"xxx","ProtectionGroupId":{"GroupGuid":"b77dfe08-3b8a-4312-bb6d-a0472ad216b4"},"SiteId":null},{"HostId":null,"Name":"Local","ProtectionGroupId":null,"SiteId":{"SiteGuid":"3fad0bc0-8c6d-4673-aad6-bb4f9e4ed26a"}}],"ProtectionGroupId":{"GroupGuid":"b77dfe08-3b8a-4312-bb6d-a0472ad216b4"},"InitiatedBy":"root","Started":"13/10/2014 08:09:30","Completed":"13/10/2014 08:09:59","TaskId":{"Identifier":"468fec99-11cf-4e08-8cb0-7094d6882d58","SiteId":{"SiteGuid":"3fad0bc0-8c6d-4673-aad6-bb4f9e4ed26a"}},"IsCancellable":false,"Information":"","id":"468fec99-11cf-4e08-8cb0-7094d6882d58","TaskTypeName":"Creating VPG","StatusText":"Completed","CurrentState":5,"RelatedText":"xxx, Local"}];
        controller = $controller('tasksListController', {$scope: testScope, $translate: $translate, siteSettingsFactory: siteSettingsFactory});
    }));


    it("should show data as empty", function () {
        expect(testScope.data).toBeDefined();
        expect(testScope.data.length).toEqual(5);
    });

    it("should check grid definitions",function(){
        expect(testScope.customOptions).toBeDefined();
        expect(testScope.showCheckbox).toBeFalsy();

        expect(testScope.groupByValues).toEqual([{id: '',text: 'GROUP_BY_LIST.NONE'},{id: 'TaskTypeName',text: 'GROUP_BY_LIST.TASK_TYPE'}]);
    });

    it("should check scope defenitions", function () {
        expect(testScope.timeList.length).toEqual(7);
        expect(testScope.selectedTime).toEqual(-1);
        expect(testScope.statusList.length).toEqual(4);
        expect(testScope.selectedStatuses).toBeDefined();
        expect(testScope.changeTimeFilter).toBeDefined();
    });
});
